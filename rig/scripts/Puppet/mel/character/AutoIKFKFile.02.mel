global proc AutoIKFK(){if (`window -ex AutoIKFK` ==true ){deleteUI AutoIKFK;}	window -w 110 -h 60 -t ("AutoIKFK") -in "AutoIKFK" -s true -tb true AutoIKFK;	columnLayout -adj true;		rowColumnLayout -nc 2 -cw 1 100;	text -l "select AU Curve" -al "center";	button -l "IKFK" -c IKFK;	setParent "..";	showWindow AutoIKFK;}AutoIKFK;global proc IKFK(){//提取大组名称string $selAuto[] = `ls -sl`;int $num = `size $selAuto[0]`;int $num_G_Num = $num - 9;string $selAutoName;$selAutoName = `substring $selAuto[0] $num_G_Num $num`;if ($selAutoName!="Arm_R_Auto"&&$selAutoName!="Arm_L_Auto") {warning "please select AUcurve!";}else{$NameNum = `size $selAuto[0]`;$Name_G_Num = $NameNum-10;$Name_G = `substring $selAuto[0] 1 $Name_G_Num`; $LRNum = $NameNum-5;$LR = `substring  $selAuto[0] $LRNum $LRNum`;$ArmIKFKCtl =`ls -r 1 "*Hand_IK_R_Ctl" "*Shoulder_Fk_R_Ctl" "*Elbow_FK_R_Ctl"  "*Hand_FK_R_Ctl"  "*Arm_Vector_R_Ctl"  "*Hand_IKFk_R_Ctl"  "*Arm_Vector_R_Ctl_Point"  "*AutoIKFK_Shoulder_R_Loc"  "*AutoIKFK_Elbow_R_Loc"  "*AutoIKFK_Wrist_R_Loc" "*Hand_IK_L_Ctl" "*Shoulder_Fk_L_Ctl" "*Elbow_FK_L_Ctl"  "*Hand_FK_L_Ctl"  "*Arm_Vector_L_Ctl"  "*Hand_IKFk_L_Ctl"  "*Arm_Vector_L_Ctl_Point"  "*AutoIKFK_Shoulder_L_Loc"  "*AutoIKFK_Elbow_L_Loc"  "*AutoIKFK_Wrist_L_Loc" "*AutoIKFK_IKHandRo_L_Loc"`;string $LNAutoIKFK_IKHandRo_L_Loc,$LNIKFK_Wrist_L_Loc,$LNAtIKFK_Elbow_L_Loc,$LNAtIKFK_Shoulder_L_Loc,$LNArm_Vector_L_Ctl_Point,$LNHand_IKFk_L_Ctl,$LNArm_Vector_L_Ctl,$LNHand_FK_L_Ctl,$LNElbow_FK_L_Ctl,$LNHand_IK_L_Ctl,$LNShoulder_Fk_L_Ctl,$LNShoulder_Fk_R_Ctl,$LNHand_IK_R_Ctl,$LNHand_FK_R_Ctl,$LNElbow_FK_R_Ctl,$LNArm_Vector_R_Ctl,$LNHand_IKFk_R_Ctl,$LNArm_Vector_R_Ctl_Point,$LNAtIKFK_Shoulder_R_Loc,$LNAtIKFK_Elbow_R_Loc,$LNIKFK_Wrist_R_Loc;for($b in $ArmIKFKCtl){	if(startsWith($b,$Name_G)){ 		if(endsWith($b,"Shoulder_Fk_R_Ctl")){	 		$LNShoulder_Fk_R_Ctl = $b;		}		else if(endsWith($b,"Hand_IK_R_Ctl")){			$LNHand_IK_R_Ctl = $b;		}		else if(endsWith($b,"Elbow_FK_R_Ctl")){			$LNElbow_FK_R_Ctl = $b;		}		else if(endsWith($b,"Hand_FK_R_Ctl")){			$LNHand_FK_R_Ctl = $b;		}			else if(endsWith($b,"Arm_Vector_R_Ctl")){			$LNArm_Vector_R_Ctl = $b;		}		else if(endsWith($b,"Hand_IKFk_R_Ctl")){			$LNHand_IKFk_R_Ctl = $b;		}		else if(endsWith($b,"Arm_Vector_R_Ctl_Point")){			$LNArm_Vector_R_Ctl_Point = $b;		}		else if(endsWith($b,"AutoIKFK_Shoulder_R_Loc")){			$LNAtIKFK_Shoulder_R_Loc = $b;		}		else if(endsWith($b,"AutoIKFK_Elbow_R_Loc")){			$LNAtIKFK_Elbow_R_Loc = $b;		}		else if(endsWith($b,"AutoIKFK_Wrist_R_Loc")){			$LNIKFK_Wrist_R_Loc = $b;		}		else if(endsWith($b,"Shoulder_Fk_L_Ctl")){			$LNShoulder_Fk_L_Ctl = $b;		}		else if(endsWith($b,"Hand_IK_L_Ctl")){			$LNHand_IK_L_Ctl = $b;		}		else if(endsWith($b,"Elbow_FK_L_Ctl")){			$LNElbow_FK_L_Ctl = $b;		}		else if(endsWith($b,"Hand_FK_L_Ctl")){			$LNHand_FK_L_Ctl = $b;		}			else if(endsWith($b,"Arm_Vector_L_Ctl")){			$LNArm_Vector_L_Ctl = $b;		}		else if(endsWith($b,"Hand_IKFk_L_Ctl")){			$LNHand_IKFk_L_Ctl = $b;		}		else if(endsWith($b,"Arm_Vector_L_Ctl_Point")){			$LNArm_Vector_L_Ctl_Point = $b;		}		else if(endsWith($b,"AutoIKFK_Shoulder_L_Loc")){			$LNAtIKFK_Shoulder_L_Loc = $b;		}		else if(endsWith($b,"AutoIKFK_Elbow_L_Loc")){			$LNAtIKFK_Elbow_L_Loc = $b;		}		else if(endsWith($b,"AutoIKFK_Wrist_L_Loc")){			$LNIKFK_Wrist_L_Loc = $b;		}		else if(endsWith($b,"AutoIKFK_IKHandRo_L_Loc")){			$LNAutoIKFK_IKHandRo_L_Loc = $b;		}}}if($LR=="R"){//控制器完整名称//$LNShoulder_Fk_R_Ctl = $Name_G + "Scapula_R_Ctl_Cn|Scapula_R_Ctl|Shoulder_Fk_R_Ctl_Cn|Shoulder_Fk_R_Ctl";//$LNElbow_FK_R_Ctl = $Name_G + "Scapula_R_Ctl_Cn|Scapula_R_Ctl|Shoulder_Fk_R_Ctl_Cn|Shoulder_Fk_R_Ctl|Elbow_FK_R_Ctl_Cn|Elbow_FK_R_Ctl";//$LNHand_FK_R_Ctl = $Name_G + "Scapula_R_Ctl_Cn|Scapula_R_Ctl|Shoulder_Fk_R_Ctl_Cn|Shoulder_Fk_R_Ctl|Elbow_FK_R_Ctl_Cn|Elbow_FK_R_Ctl|Hand_FK_R_Ctl_Cn|Hand_FK_R_Ctl";//$LNHand_IK_R_Ctl = $Name_G + "Back_Ctl_Cn|Back_Ctl|Hand_IK_R_Ctl_Cn|Hand_IK_R_Ctl";//$LNArm_Vector_R_Ctl = $Name_G + "Arm_Vector_R_Ctl_Cn|Arm_Vector_R_Ctl";//$LNHand_IKFk_R_Ctl = $Name_G + "Finger_R_Ctl_All|Hand_IKFk_R_Ctl_Cn|Hand_IKFk_R_Ctl";//$LNArm_Vector_R_Ctl_Point = $Name_G +"Arm_Vector_R_Ctl_Point";//IK转FKlocator完整名称$IKFK = `getAttr ($LNHand_IKFk_R_Ctl+".IKFK")`;	if($IKFK==1)	{		//$LNAtIKFK_Shoulder_R_Loc = $Name_G + "AutoIKFK_Shoulder_R_Loc_Cn|AutoIKFK_Shoulder_R_Loc";		//$LNAtIKFK_Elbow_R_Loc = $Name_G + "AutoIKFK_Elbow_R_Loc_Cn|AutoIKFK_Elbow_R_Loc";		//$LNIKFK_Wrist_R_Loc = $Name_G + "AutoIKFK_Wrist_R_Loc_Cn|AutoIKFK_Wrist_R_Loc";				$Shoulder_Fk_R_Ctl_Ro = `xform -q -os -ro $LNAtIKFK_Shoulder_R_Loc`;		$Elbow_FK_R_Ctl_Ro = `xform -q -os -ro $LNAtIKFK_Elbow_R_Loc`;		$Hand_FK_R_Ctl_Ro = `xform -q -os -ro $LNIKFK_Wrist_R_Loc`;		setAttr ($LNShoulder_Fk_R_Ctl+".rx") $Shoulder_Fk_R_Ctl_Ro[0];		setAttr ($LNShoulder_Fk_R_Ctl+".ry") $Shoulder_Fk_R_Ctl_Ro[1];		setAttr ($LNShoulder_Fk_R_Ctl+".rz") $Shoulder_Fk_R_Ctl_Ro[2];		//setAttr ($LNElbow_FK_R_Ctl+".rx") $Elbow_FK_R_Ctl_Ro[0];		setAttr ($LNElbow_FK_R_Ctl+".ry") $Elbow_FK_R_Ctl_Ro[1];		//setAttr ($LNElbow_FK_R_Ctl+".rz") $Elbow_FK_R_Ctl_Ro[2];		setAttr ($LNHand_FK_R_Ctl+".rx") $Hand_FK_R_Ctl_Ro[0];		setAttr ($LNHand_FK_R_Ctl+".ry") $Hand_FK_R_Ctl_Ro[1];		setAttr ($LNHand_FK_R_Ctl+".rz") $Hand_FK_R_Ctl_Ro[2];				setAttr ($LNHand_IKFk_R_Ctl+".IKFK") 0;	}	else	{		//$LNAtIKFK_Shoulder_R_Loc = $Name_G + "AutoIKFK_Shoulder_R_Loc_Cn|AutoIKFK_Shoulder_R_Loc";		//$LNAtIKFK_Elbow_R_Loc = $Name_G + "AutoIKFK_Elbow_R_Loc_Cn|AutoIKFK_Elbow_R_Loc";		//$LNIKFK_Wrist_R_Loc = $Name_G + "AutoIKFK_Wrist_R_Loc_Cn|AutoIKFK_Wrist_R_Loc";				//极限量位置//////////////////////////////////////////////////////		float $aa[] = `xform -q -ws -t $LNElbow_FK_R_Ctl`;		float $bb[] = `xform -q -ws -t $LNShoulder_Fk_R_Ctl`;		float $dd[] = `xform -q -ws -t $LNHand_FK_R_Ctl`;		float $ee[] = `xform -q -ws -t $LNElbow_FK_R_Ctl`;		float $psphereT[] = `xform -q -ws -t $LNArm_Vector_R_Ctl`;		//距离测量		vector $disTT = <<$psphereT[0]-$aa[0],$psphereT[1]-$aa[1],$psphereT[2]-$aa[2]>>;		float $disTTP = mag($disTT);		//骨骼之间夹角		vector $cc1 =`unit(<<($aa[0]-$bb[0]),($aa[1]-$bb[1]),($aa[2]-$bb[2])>>)`;		vector $cc2 =`unit(<<$dd[0]-$ee[0],$dd[1]-$ee[1],$dd[2]-$ee[2]>>)`;		float  $dot = dot($cc1,$cc2);		float $angle = 180 -  acosd($dot) ;		if($angle>179.999)		{		$Arm_Vector_R_Ctl_PointCt = `pointConstraint -w 1 $LNAtIKFK_Elbow_R_Loc $LNArm_Vector_R_Ctl`;		delete $Arm_Vector_R_Ctl_PointCt;		setAttr ($LNArm_Vector_R_Ctl+".translateZ") 0;		//setAttr ($LNArm_Vector_R_Ctl+".translateX") 0;		//setAttr ($LNArm_Vector_R_Ctl+".translateY") 0;		//setAttr ($LNArm_Vector_R_Ctl+".translateZ") 0;			}		else		{		$normal = cross($cc1,$cc2);		$final1 = -1*rot($cc2 , $normal , deg_to_rad($angle)/2)*$disTTP;		xform -ws -t ( $final1.x + $aa[0]) ( $final1.y + $aa[1]) ( $final1.z + $aa[2] ) $LNArm_Vector_R_Ctl_Point;				///////////////////////////////////////////////////////////////////////////////////////////////////////////		$Hand_FK_R_Ctl_TranParent = `parentConstraint -w 1 $LNHand_FK_R_Ctl $LNHand_IK_R_Ctl`;		delete $Hand_FK_R_Ctl_TranParent;		$LNArm_Vector_R_Ctl_TranParent = `pointConstraint -w 1 $LNArm_Vector_R_Ctl_Point $LNArm_Vector_R_Ctl`;		delete $LNArm_Vector_R_Ctl_TranParent;		}		setAttr ($LNHand_IKFk_R_Ctl +".IKFK") 1;	}}else{//控制器完整名称//$LNShoulder_Fk_L_Ctl = $Name_G + "Scapula_L_Ctl_Cn|Scapula_L_Ctl|Shoulder_Fk_L_Ctl_Cn|Shoulder_Fk_L_Ctl";//$LNElbow_FK_L_Ctl = $Name_G + "Scapula_L_Ctl_Cn|Scapula_L_Ctl|Shoulder_Fk_L_Ctl_Cn|Shoulder_Fk_L_Ctl|Elbow_FK_L_Ctl_Cn|Elbow_FK_L_Ctl";//$LNHand_FK_L_Ctl = $Name_G + "Scapula_L_Ctl_Cn|Scapula_L_Ctl|Shoulder_Fk_L_Ctl_Cn|Shoulder_Fk_L_Ctl|Elbow_FK_L_Ctl_Cn|Elbow_FK_L_Ctl|Hand_FK_L_Ctl_Cn|Hand_FK_L_Ctl";//$LNHand_IK_L_Ctl = $Name_G + "Back_Ctl_Cn|Back_Ctl|Hand_IK_L_Ctl_Cn|Hand_IK_L_Ctl";//$LNArm_Vector_L_Ctl = $Name_G + "Arm_Vector_L_Ctl_Cn|Arm_Vector_L_Ctl";//$LNHand_IKFk_L_Ctl = $Name_G + "Finger_L_Ctl_All|Hand_IKFk_L_Ctl_Cn|Hand_IKFk_L_Ctl";//$LNAutoIKFK_IKHandRo_L_Loc = $Name_G + "Scapula_L_Ctl_Cn|Scapula_L_Ctl|Shoulder_Fk_L_Ctl_Cn|Shoulder_Fk_L_Ctl|Elbow_FK_L_Ctl_Cn|Elbow_FK_L_Ctl|Hand_FK_L_Ctl_Cn|Hand_FK_L_Ctl|AutoIKFK_IKHandRo_L_Loc";//$LNArm_Vector_L_Ctl_Point = $Name_G +"Arm_Vector_L_Ctl_Point";//IK转FKlocator完整名称$IKFK = `getAttr ($LNHand_IKFk_L_Ctl+".IKFK")`;	if($IKFK==1)	{		//$LNAtIKFK_Shoulder_L_Loc = $Name_G + "AutoIKFK_Shoulder_L_Loc_Cn|AutoIKFK_Shoulder_L_Loc";		//$LNAtIKFK_Elbow_L_Loc = $Name_G + "AutoIKFK_Elbow_L_Loc_Cn|AutoIKFK_Elbow_L_Loc";		//$LNIKFK_Wrist_L_Loc = $Name_G + "AutoIKFK_Wrist_L_Loc_Cn|AutoIKFK_Wrist_L_Loc";					$Shoulder_Fk_L_Ctl_Ro = `xform -q -os -ro $LNAtIKFK_Shoulder_L_Loc`;		$Elbow_FK_L_Ctl_Ro = `xform -q -os -ro $LNAtIKFK_Elbow_L_Loc`;		$Hand_FK_L_Ctl_Ro = `xform -q -os -ro $LNIKFK_Wrist_L_Loc`;		setAttr ($LNShoulder_Fk_L_Ctl+".rx") $Shoulder_Fk_L_Ctl_Ro[0];		setAttr ($LNShoulder_Fk_L_Ctl+".ry") $Shoulder_Fk_L_Ctl_Ro[1];		setAttr ($LNShoulder_Fk_L_Ctl+".rz") $Shoulder_Fk_L_Ctl_Ro[2];		//setAttr ($LNElbow_FK_L_Ctl+".rx") $Elbow_FK_L_Ctl_Ro[0];		setAttr ($LNElbow_FK_L_Ctl+".ry") $Elbow_FK_L_Ctl_Ro[1];		//setAttr ($LNElbow_FK_L_Ctl+".rz") $Elbow_FK_L_Ctl_Ro[2];		setAttr ($LNHand_FK_L_Ctl+".rx") $Hand_FK_L_Ctl_Ro[0];		setAttr ($LNHand_FK_L_Ctl+".ry") $Hand_FK_L_Ctl_Ro[1];		setAttr ($LNHand_FK_L_Ctl+".rz") $Hand_FK_L_Ctl_Ro[2];				setAttr ($LNHand_IKFk_L_Ctl+".IKFK") 0;	}	else	{		//$LNAtIKFK_Shoulder_L_Loc = $Name_G + "AutoIKFK_Shoulder_L_Loc_Cn|AutoIKFK_Shoulder_L_Loc";		//$LNAtIKFK_Elbow_L_Loc = $Name_G + "AutoIKFK_Elbow_L_Loc_Cn|AutoIKFK_Elbow_L_Loc";		//$LNIKFK_Wrist_L_Loc = $Name_G + "AutoIKFK_Wrist_L_Loc_Cn|AutoIKFK_Wrist_L_Loc";			//极限量位置//////////////////////////////////////////////////////		float $aa[] = `xform -q -ws -t $LNElbow_FK_L_Ctl`;		float $bb[] = `xform -q -ws -t $LNShoulder_Fk_L_Ctl`;		float $dd[] = `xform -q -ws -t $LNHand_FK_L_Ctl`;		float $ee[] = `xform -q -ws -t $LNElbow_FK_L_Ctl`;		float $psphereT[] = `xform -q -ws -t $LNArm_Vector_L_Ctl`;		//距离测量		vector $disTT = <<$psphereT[0]-$aa[0],$psphereT[1]-$aa[1],$psphereT[2]-$aa[2]>>;		float $disTTP = mag($disTT);		//骨骼之间夹角		vector $cc1 =`unit(<<($aa[0]-$bb[0]),($aa[1]-$bb[1]),($aa[2]-$bb[2])>>)`;		vector $cc2 =`unit(<<$dd[0]-$ee[0],$dd[1]-$ee[1],$dd[2]-$ee[2]>>)`;		float  $dot = dot($cc1,$cc2);		float $angle = 180 -  acosd($dot) ;		$normal = cross($cc1,$cc2);		$final1 = -1*rot($cc2 , $normal , deg_to_rad($angle)/2)*$disTTP;		xform -ws -t ( $final1.x + $aa[0]) ( $final1.y + $aa[1]) ( $final1.z + $aa[2] ) $LNArm_Vector_L_Ctl_Point;		///////////////////////////////////////////////////////////////////////////////////////////////////////////		$Hand_FK_L_Ctl_TranParent = `parentConstraint -w 1 $LNAutoIKFK_IKHandRo_L_Loc $LNHand_IK_L_Ctl`;		delete $Hand_FK_L_Ctl_TranParent;		$LNArm_Vector_L_Ctl_TranParent = `pointConstraint -w 1 $LNArm_Vector_L_Ctl_Point $LNArm_Vector_L_Ctl`;		delete $LNArm_Vector_L_Ctl_TranParent;		setAttr ($LNHand_IKFk_L_Ctl +".IKFK") 1;	}}}}